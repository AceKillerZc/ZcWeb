<extend name="Layout/index" />
<block name="head">
	<link rel="stylesheet" type="text/css" href="__CUBE__/css/libs/dropzone.css">
	<link rel="stylesheet" type="text/css" href="__CUBE__/css/libs/magnific-popup.css">
</block>
<block name="content">
	<div class="row">
		<div class="col-lg-12">
			<div class="main-box">
				<header class="main-box-header">
					<h2>Images with Lightbox</h2>
				</header>

				<div class="main-box-body">
					<div id="gallery-photos-lightbox">
						<ul class=" clearfix gallery-photos">
							<volist name="photo" id="photo">

								<li class="col-md-3 col-sm-3 col-xs-6">

									<a href="{$photo.imgurl}" class="photo-box image-link" style="background-image: url('{$photo.imgurl}');"></a>
									<span class="thumb-meta-time"><i class="fa fa-clock-o"></i> 23 minutes ago</span>
								</li>

							</volist>
						</ul>
					</div>
				</div>


			</div>
		</div>
	</div>
</block>

<block name="after">

	<script src="__CUBE__/js/jquery-ui.custom.min.js"></script>
	<script src="__CUBE__/js/dropzone.js"></script>
	<script src="__CUBE__/js/jquery.magnific-popup.min.js"></script>
	<script>
		$(function() {

			$(document).ready(function() {
				$('#gallery-photos-lightbox').magnificPopup({
					type: 'image',
					delegate: 'a',
					gallery: {
						enabled: true
					}
				});
			});
		});
	</script>
</block>


<include file="Public:doct" />
	{//详情页Css js}
	<import type="css" file="css.album.detail" />

	<include file="Public:head" />{// 头部公共文件 }
	<script>
		function deletePhotoEffect(id)
		{
	        $.ajax({
	            type:"POST",
	            url:VIP.Base()+"/photo/del.html",
	            data:"id="+id+"&aid={$album.id}",
	            async:true,
	            dataType:"json",
	            success: function(msg)
	            {
	                if(msg.success == 1)
	                {
	                	VIP.MessageBox.createBoxAuto("删除成功！")
						$("#album"+id).hide();
	                }
	                else
	                {
	                	VIP.MessageBox.createBoxAuto("删除失败"+msg.error_str)
	                }
	            }
	        });
			
		}
		function deletePhoto(id)
		{
			VIP.MessageBox.createBoxConfirmCancle("确定删除?",{
				callback:deletePhotoEffect,
				data:id});
		}
		function setFaceEffect(face)
		{
	        $.ajax({
	            type:"POST",
	            url:VIP.Base()+"/album/setface.html",
	            data:"id={$album.id}&face="+face,
	            async:true,
	            dataType:"json",
	            success: function(msg)
	            {
	                if(msg.success == 1)
	                {
	                	VIP.MessageBox.createBoxAuto("设置成功！")
						
	                }
	                else
	                {
	                	VIP.MessageBox.createBoxAuto("设置失败"+msg.error_str)
	                }
	            }
	        });
			
		}
		
		function setFace(face)
		{
			VIP.MessageBox.createBoxConfirmCancle("设为封面?",{
				callback:setFaceEffect,
				data:face});
		}
	
		//特效
		function showAllPhoto()
		{
			var pdata = []
			var s = $(".imgstore").size()
			for(var i=0;i<s;i++)
			{
				pdata[i] = $(".imgstore").eq(i).find("img").attr("src")
			}
			var cIndex = 0;
			VIP.Layer.show();
			//左右2个按钮
			var leftStr = "<img src='__PUBLIC__/img/button/ORB_Icons_by_008.png' id='leftImg'>"
			var rightStr = "<img src='__PUBLIC__/img/button/ORB_Icons_by_007.png' id='rightImg'>"
			var closeStr = "<img src='__PUBLIC__/img/button/ORB_Icons_by_003.png' id='closeImg'>"
			$(document.body).append(leftStr)
			$(document.body).append(rightStr)
			$(document.body).append(closeStr)
			$("#leftImg").css({
				position:"fixed",zIndex:303,left:"100px",
				top:"350px",cursor:"pointer",
			})
			$("#rightImg").css({
				position:"fixed",zIndex:303,right:"100px",
				top:"350px",cursor:"pointer",
			})
			$("#closeImg").css({
				position:"fixed",zIndex:303,right:"0px",
				top:"0px",cursor:"pointer",
			})
			//中间的图片
			var showStr = "<img src='' id='showImg'>"
			$(document.body).append(showStr)
			$("#showImg").css({
				position:"fixed",zIndex:302,cursor:"pointer"
			})
			$("#showImg").attr("src",pdata[cIndex])
			VIP.Layer.center($("#showImg"))
			
			$("#closeImg").click(function(){
				VIP.Layer.hide();
				$("#leftImg").remove();
				$("#rightImg").remove();
				$("#closeImg").remove();
				$("#showImg").remove();
			})
			$("#leftImg").click(function(){
				$(this).animate({opacity:0},300,null,function(){
					$(this).animate({opacity:1},300,null,function(){
						
					})
				})
				
				cIndex = cIndex -1;
				if(cIndex < 0)
					cIndex = s
					$("#showImg").attr("src",pdata[cIndex])	
					VIP.Layer.center($("#showImg"))
			})
			$("#rightImg").click(function(){
				$(this).animate({opacity:0},300,null,function(){
					$(this).animate({opacity:1},300,null,function(){
						
					})
				})
				cIndex = cIndex +1;
				if(cIndex == s)
					cIndex = 0
					$("#showImg").attr("src",pdata[cIndex])	
					VIP.Layer.center($("#showImg"))
			})
		}
	</script>
    <div id="container" class="box_shadow box_shadow_inset .border_radius">
    	  <include file="Album:album_head" />
    	  
    	  <div id="article_show">
					<div id="album_photo">
						<div class="album_desc">当前相册:{$album.title}</div>
						<volist name="photo" id="photo">
							<div class="imgstore G_box_shadow G_border_radius" id="album{$photo.id}">
							<img src="{$photo.imgurl}" width=172 height=172 onclick="showAllPhoto()"/>
							<span class="G_box_shadow G_border_radius">
								<if condition="$my eq 1"><a href="javascript:setFace('{$photo.imgurl}');">设为封面</a> <a href="javascript:deletePhoto('{$photo.id}');">删除</a>
								<else />
								{$photo.time|date="Y-m-d",###}
								</if>
							</span>
							</div>
						</volist>
					
					{//评论功能}

					<!-- 多说评论框 start -->
					<div class="ds-thread" data-thread-key="{$article.id}" data-title="{$article.title}" data-url="http://www.vipmhxy.com/album/detail/id/{$article.id}.html"></div>
					<!-- 多说评论框 end -->
					<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
					<script type="text/javascript">
						var duoshuoQuery = {short_name:"peakpointer"};
						(function() {
							var ds = document.createElement('script');
								ds.type = 'text/javascript';ds.async = true;
								ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
								ds.charset = 'UTF-8';
								(document.getElementsByTagName('head')[0] 
		 						|| document.getElementsByTagName('body')[0]).appendChild(ds);
								})();
					</script>
					<!-- 多说公共JS代码 end -->
					</div>
		</div>
    </div>

    
    <include file="Public:footer" />{// 底部公共文件 }
</body>
</html>
