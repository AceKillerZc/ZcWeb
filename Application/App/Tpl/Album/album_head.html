<import type="css"  file="css.article.article_head" />
<style>
	#createAlbum{
		border:2px solid #55437a;
	}
	#createAlbum table{
		width:480px;
		float:left;
		margin-left:10px;
		margin-top:20px;
	}
	#createAlbum table tr{margin:10px;height:30px;}
	#createAlbum input[type=radio]{
		width:15px;
		display:inline-block;
		position:relative;
		top:5px;
		
	}
	#createAlbum p{float:left;}
	
	#updateAlbum{
		border:2px solid #55437a;
	}
	#updateAlbum table{
		width:480px;
		float:left;
		margin-left:10px;
		margin-top:20px;
	}
	#updateAlbum table tr{margin:10px;height:30px;}
	#updateAlbum input[type=radio]{
		width:15px;
		display:inline-block;
		position:relative;
		top:5px;
		
	}
	#updateAlbum p{float:left;}
	.ensure{
		width:100%;
		float:left;
		background:#b3acc0;
		margin-top:15px;
		height:30px;
		line-height:30px;
	}
	.ensure a{margin-top:5px;text-decoration:none;text-align:center;color:#333;border:1px solid #333;float:right;width:50px;height:20px;line-height:20px;margin-right:5px;dislpay:inline-block;}
	
	#ensure2,#ensure22,#ensure222{background:#31c4f5;color:#fff;}
	#ensure1,#ensure11,#ensure1111{background:#eee;}

	
	#UploadPhoto{
		border:2px solid #55437a;
	}
	#UploadPhoto table{
		width:480px;
		float:left;
		margin-left:10px;
		margin-top:20px;
	}
	#UploadPhoto table tr{margin:10px;height:30px;}
	#UploadPhoto p{float:left;}
	
</style>
<script>
//创建框
	var createStr = '<div id="createAlbum" class=" G_border_radius G_box_shadow_inset">\
		<form method="post">\
		<div class="G_close" style="background:#b3acc0;height:30px;line-height:30px;font-size:16px;"><div style="float:left;padding-left:20px;color:#555;">创建相册</div><span style="margin-top:5px;" id="aspan"></span> </div>\
		<table><tr><td class="formTRight">相册名称：</td><td class="formTLeft"><input type="text" name="title" id="album_title" class="formInputText"><p>(30个字)</p></td></tr>\
		<tr><td class="formTRight">相册描述：</td><td class="formTLeft"><textarea name="content" class="formTextarea" id="album_content"></textarea><p>(200个字)</p></td></tr>\
		<tr><td class="formTRight">可见性： </td><td class="formTLeft"><input type="radio" name="auth" value=0 checked>对所有人可见<br /><input type="radio" name="auth" value=1>仅主人可见</td></tr>\
		</table></form>\
		<div class="ensure"><a href="javascript:;" id="ensure1" class="G_border_radius">取消</a><a class="G_border_radius" href="javascript:;" id="ensure2">确定</a> </div>\
	</div>';
	

	//提交信息
	function postMessage()
	{
		var t = $('#album_title').val().replace( /^\s+|\s+$/g, "" );
		var c = $('#album_content').val().replace( /^\s+|\s+$/g, "" );
		var tl = VIP.Form.getStrLength(t);
		var cl = VIP.Form.getStrLength(c);
		
		if(tl > 30){
			VIP.MessageBox.createBoxAuto("相册名称不能超过30个字")
			return;
		}
		if(cl > 200)
		{
			VIP.MessageBox.createBoxAuto("相册内容不能超过200个字")
			return;
		}
		
		var a = $("input[name='auth']:checked").val();
		VIPLog("单选按钮的值  "+a);
        $.ajax({
            type:"POST",
            url:VIP.Base()+"/album/dealCreate",
            data:"title="+t+"&content="+c+"&auth="+a,
            async:true,
            dataType:"json",
            success: function(msg)
            {
                if(msg.success == 1)
                {
                	VIP.MessageBox.createBoxConfirmCancle("创建成功！",{callback:function(){
                		VIP.Jump('/album/mylist.html?r='+Math.random());
                	},data:null})
                }
                else
                {
                	VIP.MessageBox.createBoxAuto("创建失败")
                }
            }
        });
	}
	
	function CreateAlbum()
	{
		if (VIP.User.checkAuth('{$_SESSION["Auth"]["id"]}')){
			return;
		}
		
		
		var tmp = $("#createAlbum")
		if (isUndefined(tmp.html()) )
		{
			VIP.Layer.show();
			$(document.body).append(createStr)
			
			$("#createAlbum").css({position:"fixed",background:"#fff",zIndex:302,top:200,width:"500px",minHeight:"200px"})
			$("#createAlbum").fadeIn()
			VIP.Layer.center($("#createAlbum"))
			//注册关闭 事件
			$("#aspan").click(function(){
				$("#createAlbum").fadeOut()
				VIP.Layer.hide()
			})
			$("#ensure1").click(function(){
				$("#createAlbum").fadeOut()
				VIP.Layer.hide()
			})
			$("#ensure2").click(function(){
				postMessage();
			})
		}else{
			VIP.Layer.show();
			$("#createAlbum").show();
		}
	}
	
	function MyAlbum()
	{
		if (VIP.User.checkAuth('{$_SESSION["Auth"]["id"]}')){
			return;
		}
		VIP.Jump('/album/mylist.html?r='+Math.random());
		
	}
	
	// 174 203   162 162   21pxheight  14fontsize

	var uploadStr = '<div id="UploadPhoto" class=" G_border_radius G_box_shadow_inset">\
		<form method="post" enctype="multipart/form-data" action="__ROOT__/photo/dealCreate.html" id="photoform">\
		<div class="G_close" style="background:#b3acc0;height:30px;line-height:30px;font-size:16px;"><div style="float:left;padding-left:20px;color:#555;">上传照片</div><span style="margin-top:5px;" id="aspan3"></span> </div>\
		<table><tr><td class="formTRight">上传到相册：</td><td class="formTLeft"><select name="myalbum_id" id="myalbum_id"></select></td></tr>\
		<tr><td class="formTRight">选择图片：</td><td class="formTLeft"><input type="file" name="photo[]" multiple=”multiple”/></td></tr>\
		</table></form>\
		<div class="ensure"><a href="javascript:;" id="ensure111" class="G_border_radius">取消</a><a class="G_border_radius" href="javascript:;" id="ensure222">确定</a> </div>\
	</div>';

	//上传照片
	function UploadPhoto()
	{
		if (VIP.User.checkAuth('{$_SESSION["Auth"]["id"]}')){
			return;
		}
			
		var tmp = $("#UploadPhoto")
		if (isUndefined(tmp.html()) )
		{
			VIP.Layer.show();
			$(document.body).append(uploadStr)
			
			$("#UploadPhoto").css({position:"fixed",background:"#fff",zIndex:302,top:200,width:"500px",minHeight:"100px"})
			$("#UploadPhoto").fadeIn()
			VIP.Layer.center($("#UploadPhoto"))
			//注册关闭 事件
			$("#aspan3").click(function(){
				$("#UploadPhoto").fadeOut()
				VIP.Layer.hide()
			})
			$("#ensure111").click(function(){
				$("#UploadPhoto").fadeOut()
				VIP.Layer.hide()
			})
			$("#ensure222").click(function(){
				$("#photoform").submit();
				//postMessagePhoto();
			})
			//填充数据
			var tstr = '{$album_json}';		
			var tdata = eval('('+tstr+')');

			var opstr = ""
			for(var i=0;i<tdata.length;i++)
			{
				opstr += "<option value="+tdata[i].realid+">"+tdata[i].title+"</option>";
				
			}
			$("#myalbum_id").html(opstr)
			VIP.Event.addObject($("#UploadPhoto"))
		}else{
			VIP.Layer.show();
			$("#UploadPhoto").show();
		}
	}
	
</script>
<assign name="ismylist" value="$album_json" />
<div id="article_title">
    <ul>
    <li><a href="javascript:;" onclick="VIP.Jump('/album/index.html?r='+Math.random());">相册首页</a></li>
    <span></span>
    <li><a href="javascript:;" onclick="CreateAlbum()">创建相册</a></li>
    <span></span>
    <li><a href="javascript:;" onclick="MyAlbum()">我的相册</a></li>
    <span></span>
    <neq name="ismylist" value="">
    <li><a href="javascript:;"  onclick="UploadPhoto()">上传照片</a></li>
    </neq>
    </ul>
</div>